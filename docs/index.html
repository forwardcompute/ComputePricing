<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Price-IQ</title>
<link rel="icon" href="data:,">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --bg:#0f1216; --panel:#171b21; --muted:#202532; --text:#e7edf3; --sub:#9fb0c3;
    --accent:#7bd7ff; --ok:#27d980; --warn:#ffd166; --danger:#ff6b6b;
    --chip:#222838; --chipStroke:#2b3143; --chipText:#cfd9e5;
    --row:#12161c; --rowAlt:#141922; --badge:#283042;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
  a{color:var(--accent);text-decoration:none}
  .wrap{max-width:1120px;margin:28px auto;padding:0 18px}
  header{display:flex;align-items:center;gap:10px;margin-bottom:14px}
  header h1{font-size:26px;margin:0}
  .updated{margin-left:auto;font-size:12px;color:var(--sub);background:var(--panel);border:1px solid var(--chipStroke);padding:6px 10px;border-radius:10px}
  .row{display:grid;gap:12px}
  .hero{grid-template-columns:1fr 1fr 1fr 1fr 1fr 110px}
  .tileRow{grid-template-columns:1fr 1fr 1fr 1fr}
  @media (max-width:980px){ .hero{grid-template-columns:1fr 1fr} .tileRow{grid-template-columns:1fr 1fr}}
  .card{background:var(--panel);border:1px solid var(--muted);border-radius:14px;padding:12px}
  .select, .btn, .inp{width:100%;appearance:none;background:var(--chip);border:1px solid var(--chipStroke);color:var(--text);padding:10px 12px;border-radius:10px}
  .btn{cursor:pointer}
  .btn.clear{background:#1d2430;border-color:#2a3244}
  .stat{display:flex;flex-direction:column;gap:6px}
  .stat h4{margin:0;color:var(--sub);font-weight:600}
  .stat .val{font-size:28px;font-weight:700}
  .stat .sub{color:var(--sub);font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:var(--badge);color:var(--sub);font-size:12px;border:1px solid var(--chipStroke)}
  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  thead th{color:var(--sub);font-weight:600;text-align:left;font-size:12px;padding:0 10px 6px}
  tbody tr{background:var(--row);border:1px solid var(--muted)}
  tbody tr:nth-child(even){background:var(--rowAlt)}
  td{padding:12px 10px;vertical-align:middle}
  td .pill{display:inline-flex;align-items:center;gap:6px;background:var(--chip);border:1px solid var(--chipStroke);padding:2px 8px;border-radius:999px;font-size:12px;color:var(--chipText)}
  .right{justify-self:end;text-align:right}
  .sectionTitle{display:flex;align-items:center;gap:10px;margin:18px 4px 8px}
  .small{font-size:12px;color:var(--sub)}
  .debug{display:none}
  .debug.on{display:block}
  .controls{display:flex;gap:8px;align-items:center}
  .switch{display:inline-flex;align-items:center;gap:8px}
  .switch input{width:18px;height:18px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Price-IQ</h1>
      <span class="small">Auto-generated from <code>docs/data/derived/</code></span>
      <div class="updated" id="asOf">Updated: —</div>
    </header>

    <!-- HERO FILTERS -->
    <div class="row hero">
      <select id="f_gpu" class="select"></select>
      <select id="f_region" class="select"></select>
      <select id="f_type" class="select"></select>
      <select id="f_duration" class="select"></select>
      <select id="f_count" class="select"></select>
      <button class="btn clear" id="btnClear">Clear</button>
    </div>

    <!-- KPI TILES -->
    <div class="row tileRow" style="margin-top:12px">
      <div class="card stat"><h4>Cheapest / GPU-hr</h4><div class="val" id="kpi_low">–</div><div class="sub" id="kpi_low_sub"></div></div>
      <div class="card stat"><h4>Median / GPU-hr</h4><div class="val" id="kpi_med">–</div><div class="sub" id="kpi_med_sub"></div></div>
      <div class="card stat"><h4>Providers covered</h4><div class="val" id="kpi_prov">–</div><div class="sub" id="kpi_prov_sub"></div></div>
      <div class="card stat"><h4>Entries</h4><div class="val" id="kpi_rows">0</div><div class="sub">Rows displayed in leaderboard.</div></div>
    </div>

    <!-- LEADERBOARD -->
    <div class="sectionTitle"><h3 style="margin:0">Leaderboard (Price-IQ)</h3><span class="small" id="lbSort">Sorted by price ↑</span></div>
    <div class="card"><table id="tbl_leader"><thead><tr><th>Provider</th><th>Region</th><th>GPU</th><th>Type</th><th>Duration</th><th>Count</th><th class="right">$/GPU-hr</th><th class="right">Score</th><th class="right">Timestamp</th></tr></thead><tbody></tbody></table></div>

    <!-- ROI -->
    <div class="sectionTitle"><h3 style="margin:0">ROI (Cheapest total cost)</h3><span class="small">from <code>roi_comparison.csv</code></span></div>
    <div class="card"><table id="tbl_roi"><thead><tr><th>GPU</th><th>Count</th><th>Duration</th><th>Provider</th><th>Region</th><th class="right">$/GPU-hr</th><th class="right">Total cost</th><th class="right">When</th></tr></thead><tbody></tbody></table></div>

    <!-- QUICK CALC -->
    <div class="sectionTitle"><h3 style="margin:0">ROI Calculator (quick)</h3></div>
    <div class="card"><div class="controls" style="flex-wrap:wrap;margin-bottom:10px"><select id="qc_gpu" class="select"></select><select id="qc_region" class="select"></select><select id="qc_count" class="select"></select><select id="qc_dur" class="select"></select><label class="switch small"><input type="checkbox" id="qc_usePred"> Use predictions (P50)</label><button class="btn" id="btnCalc">Calculate</button></div><table id="tbl_qc"><thead><tr><th>Provider</th><th>Region</th><th class="right">$/GPU-hr</th><th class="right">Total cost</th><th class="right">Source</th></tr></thead><tbody></tbody></table></div>

    <!-- FORECAST -->
    <div class="sectionTitle"><h3 style="margin:0">Forecast (30 days)</h3><span class="small">from <code>forecast.csv</code></span></div>
    <div class="card"><canvas id="forecastChart" height="120"></canvas></div>

    <p class="small" style="margin:16px 4px 40px">Tip: data loads from <code>docs/data/derived/*.csv</code>.</p>
  </div>

<script>
(function(){
  const fmt={money:n=>n==null||isNaN(n)?'–':`$${Number(n).toFixed(2)}`,date:s=>s?String(s).replace('T',' ').replace('Z',''):'–'};
  const parseCSV=txt=>{const lines=txt.trim().split(/\r?\n/);const cols=lines.shift().split(",");return lines.map(l=>{const c=l.split(",");const o={};cols.forEach((h,i)=>o[h]=c[i]);return o;});};
  async function get(path){const res=await fetch("docs/data/derived/"+path,{cache:"no-store"});if(!res.ok)throw new Error(res.status);return res;}

  async function loadForecast(){
    try{
      const res=await get("forecast.csv");const txt=await res.text();const rows=parseCSV(txt);
      const f=rows.filter(r=>r.provider==="vastai"&&r.gpu_model==="H100"&&r.type==="On-Demand"&&r.duration==="1h");
      if(!f.length)return;
      const labels=f.map(r=>r.date),preds=f.map(r=>+r.pred),lo=f.map(r=>+r.pred_lo),hi=f.map(r=>+r.pred_hi);
      new Chart(document.getElementById("forecastChart"),{type:'line',data:{labels,datasets:[{label:"Forecast",data:preds,borderColor:"#60a5fa"},{label:"Lower",data:lo,borderColor:"#9ca3af",borderDash:[5,5]},{label:"Upper",data:hi,borderColor:"#9ca3af",borderDash:[5,5]}]},options:{responsive:true,plugins:{legend:{display:true}},scales:{x:{},y:{}}}});
    }catch(e){console.log("⚠️ forecast.csv missing",e);}
  }

  loadForecast();
})();
</script>
</body>
</html>





